version: 1
applications:
    - frontend:
          phases:
              preBuild:
                  commands:
                      - npm ci
              build:
                  commands:
                      - |
                          echo "current branch is ${AWS_BRANCH}"
                          if [ "${AWS_BRANCH}" == "main" ]; then  # needed for prod
                            echo "building for prod"
                            npm run build:prod
                          else                                    # needed for stage
                            echo "building for stage"
                            npm run build:stage
                          fi
          artifacts:
              baseDirectory: .next
              files:
                  - "**/*"
          cache:
              paths:
                  - node_modules/**/*
      appRoot: website
